messages:
  - role: system
    content: You are a helpful assistant that breaks down action items from a meeting
  - role: user
    content: >-
      Extract financial data from the income statement and balance sheet below


      <concepts>
       "Net Revenue" 
       "Cost of Goods" 
       "SGA"
       "Operating Profit" 
       "Net Profit" 
       "Inventory" 
       "Current Assets" 
       "Total Assets" 
       "Current Liabilities" 
       "Total Shareholder Equity"
       "Total Liabilities and Shareholder Equity"
      </concepts>"""


      <income_statement>

      {income_statement_markdown}

      </income_statement>


      <balance_sheet>

      {balance_sheet_markdown}

      </balance_sheet>"""


      Rules:

      - Company name: "{company_name}"

      - Fiscal year: {fiscal_year}

      - Report date: '{report_date}'

      - Report values in thousands (divide by 1000)

      - SGA and Cost of Goods as positive values

      - Operating/Net Profit can be negative

      - Use NULL for any missing values


      Computed fields (calculate these):

      - Gross Margin = Net Revenue - Cost of Goods (if both available, otherwise
      NULL)

      - Liabilities = Total Assets - Total Shareholder Equity (always calculate
      this)


      Important: 

      - If Cost of Goods is NULL, then Gross Margin must be NULL

      - If any component for Liabilities calculation is NULL, then Liabilities =
      NULL

          if output_format == "full_insert":
              instruction = f"{common_header} and format as a MySQL INSERT statement."
              target_table_structure = """
      The target table structure is:

      INSERT INTO financials (company_name, year, reportDate, `Net Revenue`,
      `Cost of Goods`, `Gross Margin`, `SGA`, `Operating Profit`, `Net Profit`,
      `Inventory`, `Current Assets`, `Total Assets`, `Current Liabilities`,
      `Liabilities`, `Total Shareholder Equity`, `Total Liabilities and
      Shareholder Equity`)

      VALUES (...);"""
              specific_important_notes = ""
          elif output_format == "values_only":
              instruction = f"{common_header} and return ONLY the VALUES clause for a MySQL INSERT statement."
              target_table_structure = """
      The target table structure is:

      (company_name, year, reportDate, `Net Revenue`, `Cost of Goods`, `Gross
      Margin`, `SGA`, `Operating Profit`, `Net Profit`, `Inventory`, `Current
      Assets`, `Total Assets`, `Current Liabilities`, `Liabilities`, `Total
      Shareholder Equity`, `Total Liabilities and Shareholder Equity`)


      Return ONLY the VALUES clause in this format:

      ('CompanyName', fiscal_year, 'report_date', net_revenue, cost_of_goods,
      gross_margin, sga, operating_profit, net_profit, inventory,
      current_assets, total_assets, current_liabilities, liabilities,
      total_shareholder_equity, total_liabilities_and_equity)"""
              specific_important_notes = "\n- Respond with ONLY the VALUES clause, no other text"
          else:
              raise ValueError(f"Invalid output_format: {output_format}")

          full_prompt = f"""{instruction}
      {concepts_block}

      {data_blocks}

      {target_table_structure}

      {common_rules}

      {computed_fields}

      {common_important_notes}{specific_important_notes}

      """
model: openai/gpt-4o
